<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Coin Collector Telegram Project</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script> <!-- Telegram API -->
<!--  <script src="Build/CustomJSPlugin.js"></script> &lt;!&ndash; 引入自定义的 JS 插件 &ndash;&gt;-->
</head>
<body>
<div id="unity-container" style="width: 4000px; height: 2400px;">
  <canvas id="unity-canvas"></canvas>
</div>
<script>
  const buildUrl = "Build"; // Unity 的 WebGL 构建目录
  const loaderUrl = buildUrl + "/tgrobot.github.io.loader.js";

  // Unity 配置
  const config = {
    dataUrl: buildUrl + "/tgrobot.github.io.data",
    frameworkUrl: buildUrl + "/tgrobot.github.io.framework.js",
    codeUrl: buildUrl + "/tgrobot.github.io.wasm",
    streamingAssetsUrl: "StreamingAssets",
    companyName: "DefaultCompany",
    productName: "Sample WebGL Telegram Project",
    productVersion: "0.1.0",
  };

  // 获取 canvas 元素
  const canvas = document.querySelector("#unity-canvas");
  const script = document.createElement("script");
  script.src = loaderUrl;

  // 加载 Unity 并创建实例
  script.onload = () => {
    createUnityInstance(canvas, config).then((unityInstance) => {
      console.log("Unity instance created.");

      // 调用 CustomJSPlugin 的功能
      if (window.Telegram?.WebApp) {
        const user = window.Telegram.WebApp.initDataUnsafe.user;
        if (user) {
          console.log("Telegram User:", user);
          SendMessage("TelegramAPI", "SetTelegramUserData", JSON.stringify(user));
        } else {
          console.error("No Telegram user data found.");
        }
      } else {
        console.error("Telegram WebApp not available.");
      }
    }).catch((message) => {
      console.error("Failed to create Unity instance:", message);
    });
  };

  document.body.appendChild(script);
</script>
</body>
</html>
